{"version":3,"file":"src_app_consultation_consultation_module_ts.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAwE;AAE/B;AACM;AACF;AACU;AAEV;AAC7C,YAAY;AACqC;AAEM;AAEvD,MAAM,MAAM,GAAW;IACrB;QACE,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,gEAAgB;KAC5B;CACF,CAAC;AAaK,IAAM,sBAAsB,GAA5B,MAAM,sBAAsB;;AAAtB,sBAAsB;IAXlC,uDAAQ,CAAC;QACN,OAAO,EAAE;YACL,yDAAY;YACZ,uDAAW;YACX,uDAAW;YACX,kEAAqB,CAAC,MAAM,CAAC;YAC7B,yDAAU;YACV,8EAAmB;SACtB;QACD,YAAY,EAAE,CAAC,gEAAgB,CAAC;KACnC,CAAC;GACW,sBAAsB;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CC/BnC;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAIA;AACA;AAEA;AAEA;AAEA;AAQO,IAAMyB,gBAAgB,GAAtB,MAAMA,gBAAN,CAAsB;EAiC3BC,YACUC,WADV,EAEUC,OAFV,EAGUC,WAHV,EAIUC,MAJV,EAKUC,OALV,EAMUC,WANV,EAOUC,oBAPV,EAQUC,IARV,EASUC,mBATV,EAUSC,eAVT,EAWUC,IAXV,EAYUC,KAZV,EAaSC,eAbT,EAcUC,qBAdV,EAeSC,QAfT,EAgBUC,SAhBV,EAgBqC;IAf3B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACD;IACC;IACA;IACD;IACC;IACD;IACC;IAvCV,oBAAe,EAAf;IAEA,gBAAW,KAAX;IAEA,mBAAc,IAAd;IACA,mBAAc,KAAd;IAGA,mBAAc,KAAd;IACA,sBAAiB,KAAjB;IACA,mBAAc,IAAd;IACA,mBAAc,KAAd,CA4BqC,CA1BrC;;IACA,sBAAiB,KAAjB;IACA,mBAAc,IAAd;IACA,mBAAc,IAAd;IACA,oBAAe,IAAf;IAGQ,qBAAqC,EAArC;;IAieD,kBAAa,CAACC,OAAD,EAAgBC,QAAhB,KAAoC;MACtD,MAAMC,CAAC,GAAQF,OAAf,CADsD,CAEtD;;MACAE,CAAC,CAACC,SAAF,GAAc3B,8EAAd;MACA0B,CAAC,CAACG,gBAAF,GAAqB,IAAIC,IAAJ,EAArB;MACAJ,CAAC,CAACK,IAAF,GAASN,QAAT,CALsD,CAOtD;;MACA,OAAYD,OAAZ;IACD,CATM;EA5cH;;EAEJQ,QAAQ;IACN,KAAKC,WAAL,GAAmB,KAAKpB,WAAL,CAAiBqB,gBAApC;IAEA,KAAKC,cAAL,GAAsB,KAAKzB,WAAL,CAAiB0B,QAAjB,CAA0BC,MAA1B,CAAiCC,EAAvD;IACA,KAAKC,eAAL;IACA,KAAKC,kBAAL;IACA,KAAKC,mBAAL;EACD;;EAaDC,0BAA0B,CAACC,KAAD,EAAW;IACnCC,OAAO,CAACC,GAAR,CAAY,aAAZ;IACAF,KAAK,CAACG,wBAAN;IACAH,KAAK,CAACI,eAAN;IACAJ,KAAK,CAACK,cAAN;IACAL,KAAK,CAACM,MAAN,CAAaC,QAAb,CAAsB,GAAtB,qKAA2B,aAAW;MACpCP,KAAK,CAACG,wBAAN;MACAH,KAAK,CAACI,eAAN;MACAJ,KAAK,CAACK,cAAN;IACD,CAJD;EAKD;;EAEDP,mBAAmB;IACjB,KAAKU,aAAL,CAAmBC,IAAnB,CACE,KAAKtC,oBAAL,CAA0BuC,SAA1B,GAAsCC,SAAtC,CAAiDC,GAAD,IAAQ;MACtDX,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BU,GAA5B;;MACA,IAAIA,GAAG,CAACC,IAAJ,CAASC,YAAT,KAA0B,KAAKtB,cAAnC,EAAmD;QACjD;MACD;;MACD,IAAI,KAAKuB,YAAL,CAAkBC,IAAlB,CAAwBC,CAAD,IAAOA,CAAC,CAACtB,EAAF,KAASiB,GAAG,CAACC,IAAJ,CAASlB,EAAhD,CAAJ,EAAyD;QACvD;MACD;;MACD,KAAKvB,IAAL,CAAU8C,GAAV,CAAc,MAAK;QACjB,KAAKH,YAAL,CAAkBN,IAAlB,CAAuB,KAAKU,SAAL,CAAeP,GAAG,CAACC,IAAnB,CAAvB;MACD,CAFD;MAIA,KAAKO,cAAL;MAEA,KAAKC,YAAL;IACD,CAfD,CADF;EAkBD;;EACDxB,kBAAkB;IAChB,KAAKW,aAAL,CAAmBC,IAAnB,CACE,KAAKtC,oBAAL,CAA0BmD,YAA1B,GAAyCX,SAAzC,CAAoDX,KAAD,IAAU;MAC3D,MAAMuB,OAAO,GAAG,KAAKR,YAAL,CAAkBC,IAAlB,CACbJ,GAAD,IAASA,GAAG,CAACjB,EAAJ,KAAWK,KAAK,CAACa,IAAN,CAAWU,OAAX,CAAmB5B,EADzB,CAAhB;MAGAM,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BqB,OAA9B;;MACA,IAAIA,OAAJ,EAAa;QACXA,OAAO,CAACC,QAAR,GAAmB,IAAIrC,IAAJ,EAAnB;MACD;IACF,CARD,CADF;IAWA,KAAKqB,aAAL,CAAmBC,IAAnB,CACE,KAAKtC,oBAAL,CAA0BsD,YAA1B,GAAyCd,SAAzC,CAAoDX,KAAD,IAAU;MAC3D,MAAMuB,OAAO,GAAG,KAAKR,YAAL,CAAkBC,IAAlB,CACbJ,GAAD,IAASA,GAAG,CAACjB,EAAJ,KAAWK,KAAK,CAACa,IAAN,CAAWU,OAAX,CAAmB5B,EADzB,CAAhB;;MAGA,IAAI4B,OAAJ,EAAa;QACXA,OAAO,CAACG,UAAR,GAAqB,IAAIvC,IAAJ,EAArB;MACD;IACF,CAPD,CADF;IAUA,KAAKqB,aAAL,CAAmBC,IAAnB,CACE,KAAKtC,oBAAL,CAA0BwD,MAA1B,GAAmChB,SAAnC,CAA8CiB,CAAD,IAAM;MACjD3B,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsB0B,CAAtB,EAAyB,KAAKd,YAA9B;MAEA,KAAKe,YAAL;MACA,KAAKC,OAAL;MAEA,KAAK1D,IAAL,CAAU8C,GAAV,CAAc,MAAK;QACjBjB,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B0B,CAA1B;QACA,KAAKG,WAAL,GAAmB,IAAnB;QACA,KAAKC,WAAL,GAAmBJ,CAAC,CAACf,IAAF,CAAOD,GAA1B;QACA,KAAKqB,cAAL,GAAsB,KAAtB;MACD,CALD;IAMD,CAZD,CADF;IAeA,KAAKzB,aAAL,CAAmBC,IAAnB,CACE,KAAKtC,oBAAL,CAA0B+D,SAA1B,GAAsCvB,SAAtC,CAAiDiB,CAAD,IAAM;MACpD3B,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B0B,CAA1B;MAEA,KAAKxD,IAAL,CAAU8C,GAAV,CAAc,MAAK;QACjBjB,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B0B,CAA1B;QACA,KAAKG,WAAL,GAAmB,KAAnB;QACA,KAAKC,WAAL,GAAmB,IAAnB;QACA,KAAKC,cAAL,GAAsB,KAAtB;MACD,CALD;IAMD,CATD,CADF;EAYD;;EACDE,WAAW;IACT,KAAKtE,WAAL,CAAiBsE,WAAjB,CAA6B,KAAKrB,YAAlC;EACD;;EAEDsB,IAAI,CAACR,CAAD,EAAE;IACJ,KAAKS,QAAL,CAAcC,QAAd;;IAEA,IAAI,CAAC,KAAKC,QAAV,EAAoB;MAClB;IACD;;IAED,KAAKA,QAAL,GAAgB,KAAKA,QAAL,CAAcC,IAAd,EAAhB;IACA,KAAKzB,YAAL,CAAkBN,IAAlB,CAAuB;MACrBgC,SAAS,EAAE,UADU;MAErBC,IAAI,EAAE,KAAKH,QAFU;MAGrBI,SAAS,EAAExD,IAAI,CAACyD,GAAL;IAHU,CAAvB;IAKA,KAAKxB,cAAL;IAEA,KAAKZ,aAAL,CAAmBC,IAAnB,CACE,KAAKxC,OAAL,CACG4E,WADH,CAEI,KAAK/B,YAAL,CAAkBnB,EAAlB,IAAwB,KAAKmB,YAAL,CAAkBgC,GAF9C,EAGI,KAAKP,QAHT,EAKG5B,SALH,CAMKoC,CAAD,IAAM;MACJ9C,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2B6C,CAA3B;IACD,CARL,EASKC,GAAD,IAAQ;MACN,IAAIA,GAAG,CAACC,KAAJ,IAAaD,GAAG,CAACC,KAAJ,CAAU1B,OAAV,IAAqB,QAAtC,EAAgD;QAC9C,KAAK2B,iBAAL,CAAuB,KAAKpC,YAA5B;MACD;IACF,CAbL,CADF;IAiBA,KAAKyB,QAAL,GAAgB,EAAhB;EACD;;EACDY,kBAAkB,IAChB;IACA;IACA;EACD;;EAEDC,eAAe;IACb,IAAI,KAAK9D,WAAL,IAAoB,KAAKA,WAAL,CAAiB+D,IAAjB,KAA0B,YAAlD,EAAgE;MAC9D,KAAKhC,YAAL;IACD;;IAED,KAAKb,aAAL,CAAmBC,IAAnB,CACE,KAAK5C,WAAL,CAAiByF,YAAjB,CAA8B3C,SAA9B,CAAyC2C,YAAD,IAAiB;MACvD,KAAKA,YAAL,GAAoBA,YAApB;;MACA,IAAI,CAAC,KAAKA,YAAV,EAAwB;QACtB,KAAKjC,YAAL;MACD;IACF,CALD,CADF;EAQD;;EAEDzB,eAAe;IAAA;;IACb,MAAM2D,IAAI,GAAGC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,UAA5B,CAAb;IACA,KAAK9E,SAAL,CAAe+E,GAAf,CAAmBJ,IAAnB;IACA,KAAKK,wBAAL,GAAgC,KAAK9F,OAAL,CAC7B8B,eAD6B,CACb,KAAKJ,cADQ,EAE7BmB,SAF6B;MAAA,kKAEnB,WAAOG,YAAP,EAAuB;QAChCb,OAAO,CAACC,GAAR,CAAY,uCAAZ,EAAqDY,YAArD;;QACA,IAAI,CAACA,YAAD,IAAiB,CAACA,YAAY,CAACA,YAAnC,EAAiD;UAC/C,IAAI,KAAI,CAAC8C,wBAAT,EAAmC;YACjC,KAAI,CAACA,wBAAL,CAA8BC,WAA9B;;YACA,KAAI,CAACD,wBAAL,GAAgC,IAAhC;UACD;;UACDH,YAAY,CAACK,UAAb,CAAwB,qBAAxB;;UACA,KAAI,CAAC3F,oBAAL,CAA0B4F,UAA1B;;UACA,OAAO,KAAI,CAAC7F,WAAL,CAAiB8F,MAAjB,EAAP,CAP+C,CAQ/C;QACD;;QACD,IACE,CAAClD,YAAY,CAACA,YAAd,IACAA,YAAY,CAACA,YAAb,CAA0BmD,MAA1B,KAAqC,QAFvC,EAGE;UACA,KAAI,CAACf,iBAAL,CAAuBpC,YAAvB;QACD;;QAED,KAAI,CAACN,aAAL,CAAmBC,IAAnB,CACE,KAAI,CAAC5C,WAAL,CAAiBqG,cAAjB,CAAgC,KAAI,CAAC1E,cAArC,EAAqDmB,SAArD,CACGwD,IAAD,IAAS;UACP,KAAI,CAACnC,WAAL,GAAmBmC,IAAnB;UACA,KAAI,CAAClC,cAAL,GAAsB,KAAtB;QACD,CAJH,EAKGe,GAAD,IAAQ;UACN/C,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2C8C,GAA3C;QACD,CAPH,CADF;;QAYA,KAAI,CAACxC,aAAL,CAAmBC,IAAnB,CACE,KAAI,CAACtC,oBAAL,CAA0BiG,oBAA1B,GAAiDzD,SAAjD,CAA4DiB,CAAD,IAAM;UAC/D,IAAIA,CAAC,CAACf,IAAF,CAAOiC,GAAP,KAAe,KAAI,CAACtD,cAAxB,EAAwC;YACtC,KAAI,CAAC0D,iBAAL,CAAuBpC,YAAvB;UACD;QACF,CAJD,CADF;;QAOA,KAAI,CAAC1C,IAAL,CAAU8C,GAAV,CAAc,MAAK;UACjB,IAAI,CAAC,KAAI,CAACJ,YAAV,EAAwB;YACtB,KAAI,CAACA,YAAL,GAAoBA,YAApB;;YAEA,KAAI,CAACuD,WAAL;UACD,CAJD,MAIO;YACL,KAAI,CAACvD,YAAL,GAAoBA,YAApB;UACD;;UACD,KAAI,CAACM,cAAL;QACD,CATD;MAUD,CAlD6B;;MAAA;QAAA;MAAA;IAAA,IAAhC;EAmDD;;EAED8B,iBAAiB,CAACpC,YAAD,EAAa;IAC5Bb,OAAO,CAACC,GAAR,CAAY,gDAAZ;;IACA,IAAI,KAAK0D,wBAAT,EAAmC;MACjC,KAAKA,wBAAL,CAA8BC,WAA9B;MACA,KAAKD,wBAAL,GAAgC,IAAhC;IACD;;IACDH,YAAY,CAACK,UAAb,CAAwB,qBAAxB;IACAL,YAAY,CAACK,UAAb,CAAwB,aAAxB;;IACA,KAAK3F,oBAAL,CAA0B4F,UAA1B;;IACA,IACE,KAAKzE,WAAL,CAAiB+D,IAAjB,KAA0B,OAA1B,IACA,KAAK/D,WAAL,CAAiB+D,IAAjB,KAA0B,YAF5B,EAGE;MACA,KAAKnF,WAAL,CAAiB8F,MAAjB;IACD;;IACD,OAAO,KAAKhG,MAAL,CAAYsG,QAAZ,CAAqB,CAC1B,gBAD0B,EAE1BxD,YAAY,CAACA,YAAb,CAA0BgC,GAA1B,IAAiChC,YAAY,CAACA,YAAb,CAA0BnB,EAFjC,CAArB,CAAP;EAID;;EACD0B,YAAY;IACV,IAAI,CAAC,KAAKP,YAAV,EAAwB;MACtB;IACD;;IAED,MAAMyD,OAAO,GAAG,KAAKxD,YAAL,CAAkB,KAAKA,YAAL,CAAkByD,MAAlB,GAA2B,CAA7C,CAAhB;;IACA,IACE,KAAKlB,YAAL,IACAiB,OADA,KAECA,OAAO,CAACE,IAAR,KAAiB,WAAjB,IAAgCF,OAAO,CAACE,IAAR,KAAiB,WAFlD,CADF,EAIE;MACA;IACD;;IACD,KAAKpG,mBAAL,CAAyBgD,YAAzB,CAAsC,KAAK7B,cAA3C;EACD;;EAEDkF,OAAO,CAAC1E,KAAD,EAAM;IACX,IAAIA,KAAK,CAAC2E,QAAN,KAAmB,EAAvB,EAA2B;MACzB,KAAKvC,IAAL,CAAUpC,KAAV;MACA,OAAO,KAAP;IACD;EACF;;EAEDoB,cAAc,CAACwD,KAAD,EAAO;IACnBC,UAAU,CAAC,MAAK;MACd,IAAI,KAAKC,WAAT,EAAsB;QACpB7E,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAA6C,KAAK4E,WAAlD;QACA,KAAKA,WAAL,CAAiB1D,cAAjB;MACD;IACF,CALS,EAKPwD,KAAK,IAAI,CALF,CAAV;EAMD;;EAEKG,eAAe;IAAA;;IAAA;MACnB,MAAMC,KAAK,SAAS,MAAI,CAAC1G,eAAL,CAAqB2G,MAArB,CAA4B;QAC9CC,SAAS,EAAEhI,0HADmC;QAE9CiI,cAAc,EAAE;UAAE3F,cAAc,EAAE,MAAI,CAACA;QAAvB;MAF8B,CAA5B,CAApB;MAIA,aAAawF,KAAK,CAACI,OAAN,EAAb;IALmB;EAMpB;;EAEKC,mBAAmB;IAAA;;IAAA;MACvB,MAAML,KAAK,SAAS,MAAI,CAAC1G,eAAL,CAAqB2G,MAArB,CAA4B;QAC9CC,SAAS,EAAE/H,wHADmC;QAE9CgI,cAAc,EAAE;UAAE3F,cAAc,EAAE,MAAI,CAACA;QAAvB;MAF8B,CAA5B,CAApB;MAIA,MAAMwF,KAAK,CAACI,OAAN,EAAN;MACA,MAAM;QAAEvE;MAAF,UAAiBmE,KAAK,CAACM,YAAN,EAAvB;MAEArF,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCW,IAAhC;;MAGA,IAAIA,IAAI,CAAC0E,QAAT,EAAmB;QACjB,IAAI,OAAO1E,IAAI,CAAC0E,QAAZ,KAAyB,QAA7B,EAAuC;UACrC,MAAI,CAACC,UAAL,CAAgB3E,IAAI,CAAC0E,QAArB,EAA+B1E,IAAI,CAAC0E,QAAL,CAAcnG,IAA7C,EADqC,CAGrC;;QACD,CAJD,MAIO,IAAIyB,IAAI,CAAC0E,QAAL,CAAcf,MAAd,GAAuB,MAA3B,EAAmC;UACxC,MAAMiB,IAAI,GAAG,MAAI,CAACC,SAAL,CAAe7E,IAAI,CAAC0E,QAApB,EAA8B,YAA9B,CAAb;;UACA,MAAI,CAACC,UAAL,CAAgBC,IAAhB,EAAsB,WAAtB;QACD,CAHM,MAIF;UACH,MAAI,CAACE,MAAL,CAAY9E,IAAI,CAAC0E,QAAjB;QACD;MACF;IAvBsB;EAwBxB;;EAEDI,MAAM,CAACJ,QAAD,EAAS;IAEb,KAAKK,WAAL,GAAmB,IAAnB;IACA,KAAKrH,IAAL,CACGsH,yBADH,CAC6BN,QAD7B,EAEGO,IAFH,CAESC,KAAD,IAAU;MACd,IAAIA,KAAJ,EAAW;QACT,MAAMC,SAAS,GAAGD,KAAlB;QACA9F,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2B8F,SAA3B;QACAA,SAAS,CAACzH,IAAV,CACG0H,OAAD,IAAY;UACV,MAAMC,QAAQ,GAAGD,OAAO,CAACxB,IAAzB;UACAxE,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBgG,QAArB;UAEA,MAAMC,MAAM,GAAG,IAAIC,UAAJ,EAAf;UACA,MAAMC,IAAI,GAAG,IAAb;;UACAF,MAAM,CAACG,SAAP,GAAmB;YACjB,MAAMb,IAAI,GAAG,IAAIc,IAAJ,CACX,CAAC,IAAIC,UAAJ,CAA4B,KAAKC,MAAjC,CAAD,CADW,EAEX;cAAEhC,IAAI,EAAEyB;YAAR,CAFW,CAAb;YAIAG,IAAI,CAACb,UAAL,CAAgBC,IAAhB,EAAsBO,SAAS,CAAC5G,IAAhC;UACD,CAND;;UAQA+G,MAAM,CAACO,iBAAP,CAAyBT,OAAzB;QACD,CAhBH,EAiBGhD,KAAD,IAAU;UACR;UACA0D,KAAK,CAAC,sBAAD,CAAL;QACD,CApBH;MAsBD;IACF,CA7BH,EA8BGC,KA9BH,CA8BU5D,GAAD,IAAQ;MACb/C,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgC8C,GAAhC;IACD,CAhCH;EAiCD;;EAEDwC,UAAU,CAACC,IAAD,EAAOrG,IAAP,EAAW;IACnB,KAAKwG,WAAL,GAAmB,IAAnB;IACA,KAAKvH,mBAAL,CACGwI,QADH,CACYpB,IADZ,EACkBrG,IADlB,EACwB,KAAK0B,YAAL,CAAkBnB,EAAlB,IAAwB,KAAKmB,YAAL,CAAkBnB,EADlE,EAEGgB,SAFH,CAEcE,IAAD,IAAS;MAClB,MAAMD,GAAG,GAAGC,IAAI,CAACU,OAAjB;MAEA,KAAKnD,IAAL,CAAU8C,GAAV,CAAc,MAAK;QACjB,KAAKH,YAAL,CAAkBN,IAAlB,CAAuB,KAAKU,SAAL,CAAeP,GAAf,CAAvB;QACA,KAAKQ,cAAL;QACA,KAAKwE,WAAL,GAAmB,KAAnB;MACD,CAJD;IAKD,CAVH;EAWD,CAvZ0B,CAyZ3B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;;;EAEAkB,cAAc;IACZ,KAAKC,WAAL,GAAmB,IAAnB;IACA,MAAMxB,QAAQ,GAAG,KAAKhH,IAAL,CAAUyI,qBAAV,GAAkC7H,IAAI,CAACyD,GAAL,EAAlC,GAA+C,MAAhE;IACA,KAAKqE,SAAL,GAAiB,KAAKzI,KAAL,CAAWyG,MAAX,CAAkBM,QAAlB,CAAjB;IAEA,KAAK/E,aAAL,CAAmBC,IAAnB,CACE,KAAKwG,SAAL,CAAeC,SAAf,CAAyBvG,SAAzB,CAAoCwG,GAAD,IAAQ;MACzC,KAAKxB,MAAL,CAAYJ,QAAZ;IAED,CAHD,CADF;IAMA,KAAK/E,aAAL,CAAmBC,IAAnB,CACE,KAAKwG,SAAL,CAAeG,OAAf,CAAuBzG,SAAvB,CAAkCiB,CAAD,IAAM;MACrC3B,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsB0B,CAAtB;IACD,CAFD,CADF;IAKA,KAAKpB,aAAL,CAAmBC,IAAnB,CACE,KAAKwG,SAAL,CAAeI,cAAf,CAA8B1G,SAA9B,CAAyCsD,MAAD,IAAYhE,OAAO,CAACC,GAAR,CAAY+D,MAAZ,CAApD,CADF;IAIA,KAAKgD,SAAL,CAAeK,WAAf;EACD;;EACDnG,SAAS,CAACP,GAAD,EAAI;IACX,IAAIA,GAAG,CAAC6D,IAAJ,KAAa,YAAjB,EAA+B;MAC7B7D,GAAG,CAAC2G,cAAJ,GACE,KAAK7I,qBAAL,CAA2B8I,UAA3B,KACA,iBACE,KAAK1G,YAAL,CAAkBgC,GAAlB,IAAyB,KAAKhC,YAAL,CAAkBnB,EAC7C,eAAeiB,GAAG,CAACjB,EAAE,UAAU,KAAKL,WAAL,CAAiBmI,KAAK,EAJvD;;MAMA,IAAI7G,GAAG,CAACsF,QAAJ,CAAawB,QAAb,CAAsB,MAAtB,KAAiC9G,GAAG,CAACsF,QAAJ,CAAawB,QAAb,CAAsB,KAAtB,CAArC,EAAmE;QACjE9G,GAAG,CAAC+G,OAAJ,GAAc,IAAd;MACD,CAFD,MAEO,IAAI/G,GAAG,CAACsF,QAAJ,CAAa0B,UAAb,CAAwB,OAAxB,CAAJ,EAAsC;QAC3ChH,GAAG,CAACiH,OAAJ,GAAc,IAAd;MACD,CAFM,MAEA;QACLjH,GAAG,CAACkH,MAAJ,GAAa,IAAb;MACD;IACF;;IAED,IAAIlH,GAAG,CAACmH,IAAJ,KAAa,KAAKzI,WAAL,CAAiBK,EAAlC,EAAsC;MACpCiB,GAAG,CAAC6B,SAAJ,GAAgB,UAAhB;IACD,CAFD,MAEO;MACL7B,GAAG,CAAC6B,SAAJ,GAAgB,UAAhB;IACD;;IACD,OAAO7B,GAAP;EACD;;EAEDyD,WAAW,CAAC2D,QAAD,EAAU;IACnB,IAAI,KAAK1I,WAAL,CAAiB+D,IAAjB,KAA0B,YAA9B,EAA4C;MAC1C;IACD;;IACD,KAAK4E,WAAL,GAAmB,IAAnB;;IAEA,IAAI,CAAC,KAAKnH,YAAV,EAAwB;MACtB;IACD;;IAED,KAAK7C,OAAL,CACGiK,uBADH,CAEI,KAAKpH,YAAL,CAAkBgC,GAAlB,IAAyB,KAAKhC,YAAL,CAAkBnB,EAF/C,EAGI,KAAKoB,YAAL,CAAkByD,MAHtB,EAKG2D,IALH,CAKQ/K,sDAAK,EALb,EAMGuD,SANH,CAMcyH,IAAD,IAAS;MAClB,KAAKhK,IAAL,CAAU8C,GAAV,CAAc,MAAK;QACjB,KAAKH,YAAL,GAAoBqH,IAAI,CACrBC,GADiB,CACZpH,CAAD,IAAM;UACT,OAAO,KAAKE,SAAL,CAAeF,CAAf,CAAP;QACD,CAHiB,EAIjBqH,MAJiB,CAIV,KAAKvH,YAJK,CAApB;QAMA,KAAKkH,WAAL,GAAmB,KAAnB;;QAEA,IAAI,CAACD,QAAL,EAAe;UACb,KAAK5G,cAAL,CAAoB,GAApB;QACD;MACF,CAZD;IAaD,CApBH;EAqBD;;EAEMmH,YAAY,CAACvI,KAAD,EAAM;IACvB,KAAKwI,gBAAL,GAAwBxI,KAAK,CAACM,MAAN,CAAamI,SAArC;;IACA,IAAIzI,KAAK,CAACM,MAAN,CAAamI,SAAb,GAAyB,GAAzB,IAAgC,CAAC,KAAKR,WAA1C,EAAuD;MACrD,KAAK5D,WAAL,CAAiB,IAAjB;IACD;EACF;;EACKqE,aAAa;IAAA;;IAAA;MACjB,MAAI,CAAC3B,WAAL,GAAmB,KAAnB;MACA,MAAM,MAAI,CAACE,SAAL,CAAe0B,UAAf,EAAN;IAFiB;EAGlB;;EAaDC,YAAY,CAAC5I,KAAD,EAAM;IAChBC,OAAO,CAACC,GAAR,CAAY,KAAK4E,WAAjB,EAA8B,KAAK0D,gBAAnC;IACAvI,OAAO,CAACC,GAAR,CAAY,kBAAZ;IACA,KAAKkB,cAAL,CAAoB,GAApB;EACD;;EAEDyH,MAAM;IACJ,KAAKzK,IAAL,CAAU8C,GAAV,CAAc,MAAK;MACjBjB,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B,KAAKvB,QAAL,CAAcmK,EAAd,CAAiB,SAAjB,CAA1B;MACA5M,+EAAA,CAAiB;QAAC8M,OAAO,EAAE;MAAV,CAAjB;MACA,KAAKjH,WAAL,GAAmB,KAAnB;MACA,KAAKE,cAAL,GAAsB,KAAtB;IACD,CALD;EAMD;;EACDgH,QAAQ;IACN,KAAKzI,aAAL,CAAmBC,IAAnB,CACE,KAAK5C,WAAL,CAAiBqG,cAAjB,CAAgC,KAAK1E,cAArC,EAAqDmB,SAArD,CACGwD,IAAD,IAAS;MACPlE,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BiE,IAA1B;MACA,KAAKlC,cAAL,GAAsB,IAAtB;MACA,KAAKD,WAAL,GAAmBmC,IAAnB;IACD,CALH,EAMGnB,GAAD,IAAQ;MACN/C,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2C8C,GAA3C;IACD,CARH,CADF;EAYD;;EACDlB,OAAO;IACL7B,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgC,KAAKvB,QAArC;IACA,KAAKA,QAAL,CACGuK,KADH,GAEGpD,IAFH,CAEQ,MAAK;MACT7F,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BhE,+EAA3B;MACAA,+EAAA,CAAiB;QAAC8M,OAAO,EAAC,WAAT;QAAsBK,IAAI,EAAE;MAA5B,CAAjB;MACA,OAAOnN,+EAAA,CAAiB;QAAC8M,OAAO,EAAC;MAAT,CAAjB,CAAP,CAHS,CAIT;MACA;MACA;MACA;IACD,CAVH,EAWGlD,IAXH,CAYKwD,GAAD,IAAQ,CAAG,CAZf,EAaKtG,GAAD,IAAQ;MACN/C,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsB8C,GAAtB;IACD,CAfL;EAiBD;;EAEDuG,QAAQ,CAACC,GAAD,EAAI;IACVvJ,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBsJ,GAAvB;IACA/L,6DAAA,CAAa;MAAE+L,GAAG,EAAEA;IAAP,CAAb;EACD;;EAEDE,YAAY,CAACC,GAAD,EAAI;IAEd,KAAKC,WAAL,GAAmBD,GAAG,CAACE,MAAJ,CAAWC,UAA9B;IACA,KAAKC,WAAL,GAAmBJ,GAAG,CAACE,MAAJ,CAAWG,GAA9B;IACA,KAAKC,YAAL,GAAoB,OAApB;IACA,KAAKC,cAAL,GAAsB,IAAtB;EACD;;EACDC,aAAa,CAACC,MAAD,EAAgB;IAC3B,KAAKF,cAAL,GAAsBE,MAAtB;EACD;;EAGDvI,YAAY;IACV;IACA;IACAgD,UAAU,CAAC;MACT;MACA,MAAMwF,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAd;MACAF,KAAK,CAACG,YAAN,CAAmB,MAAnB,EAA2B,MAA3B,EAHS,CAIT;MACA;;MACAH,KAAK,CAACG,YAAN,CACE,OADF,EAEE,oGAFF;MAIAF,QAAQ,CAACG,IAAT,CAAcC,WAAd,CAA0BL,KAA1B,EAVS,CAYT;;MACAA,KAAK,CAACM,OAAN,GAAgB;QACd;QACA9F,UAAU,CAAC;UACTwF,KAAK,CAACG,YAAN,CAAmB,OAAnB,EAA4B,eAA5B;UACA3F,UAAU,CAAC;YACTyF,QAAQ,CAACG,IAAT,CAAcG,WAAd,CAA0BP,KAA1B;YACAC,QAAQ,CAACG,IAAT,CAAcI,KAAd;UACD,CAHS,EAGP,EAHO,CAAV;QAID,CANS,EAMP,GANO,CAAV;MAOD,CATD,CAbS,CAuBT;;;MACAR,KAAK,CAACQ,KAAN;IACD,CAzBS,EAyBP,EAzBO,CAAV;EA0BD;EAED;;;;;;;;;;;EASAnF,SAAS,CAACoF,OAAD,EAAUC,WAAV,EAAuBC,SAAvB,EAAiC;IACxCD,WAAW,GAAGA,WAAW,IAAI,EAA7B;IACAC,SAAS,GAAGA,SAAS,IAAI,GAAzB;IAEA,IAAIC,cAAc,GAAGC,IAAI,CAACJ,OAAD,CAAzB;IACA,IAAIK,UAAU,GAAG,EAAjB;;IAEA,KAAK,IAAIC,MAAM,GAAG,CAAlB,EAAqBA,MAAM,GAAGH,cAAc,CAACzG,MAA7C,EAAqD4G,MAAM,IAAIJ,SAA/D,EAA0E;MACxE,IAAIK,KAAK,GAAGJ,cAAc,CAACI,KAAf,CAAqBD,MAArB,EAA6BA,MAAM,GAAGJ,SAAtC,CAAZ;MAEA,IAAIM,WAAW,GAAG,IAAIC,KAAJ,CAAUF,KAAK,CAAC7G,MAAhB,CAAlB;;MACA,KAAK,IAAIgH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,KAAK,CAAC7G,MAA1B,EAAkCgH,CAAC,EAAnC,EAAuC;QACrCF,WAAW,CAACE,CAAD,CAAX,GAAiBH,KAAK,CAACI,UAAN,CAAiBD,CAAjB,CAAjB;MACD;;MAED,IAAIE,SAAS,GAAG,IAAIlF,UAAJ,CAAe8E,WAAf,CAAhB;MAEAH,UAAU,CAAC1K,IAAX,CAAgBiL,SAAhB;IACD;;IAED,IAAIjG,IAAI,GAAG,IAAIc,IAAJ,CAAS4E,UAAT,EAAqB;MAAE1G,IAAI,EAAEsG;IAAR,CAArB,CAAX;IAEA,OAAOtF,IAAP;EACD;;AA3oB0B,CAAtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAGJrJ,qDAASA;IAAAuP,OAACpP,uDAAD;;;UACTH,qDAASA;IAAAuP,OAAC,SAAD;;;UACTvP,qDAASA;IAAAuP,OAACjO,qDAAD;;;UAmETpB,wDAAYA;IAAAqP,OAAC,wBAAD,EAA2B,CAAC,QAAD,CAA3B;;;AAxEFhO,gBAAgB,eAL5BxB,yDAAS,CAAC;EACTyP,QAAQ,EAAE,kBADD;EAETC,UAAAA,+DAFS;;AAAA,CAAD,CAKmB,uDAkCJ7O,sDAAWA,KAAA,eAAXA,sDAAWA,MAAA,8CACfN,sEADe,KACI,WADJ,IACfA,sEADe,MACI,UADJ,GACIoP,EADJ,GACIC,4BACfnP,4DADe,KACD,WADC,IACfA,4DADe,MACD,UADC,GACDoP,EADC,GACDD,4BACnBpP,oDADmB,KACb,WADa,IACnBA,oDADmB,MACb,UADa,GACbsP,EADa,GACbF,4BACLlP,4DADK,KACS,WADT,IACLA,4DADK,MACS,UADT,GACSqP,EADT,GACSH,4BACVjP,2DADU,KACC,WADD,IACVA,2DADU,MACC,UADD,GACCqP,EADD,GACCJ,4BACFhP,uEADE,KACiB,WADjB,IACFA,uEADE,MACiB,UADjB,GACiBqP,EADjB,GACiBL,4BACnC1P,kDADmC,KAC7B,WAD6B,IACnCA,kDADmC,MAC7B,UAD6B,GAC7BgQ,EAD6B,GAC7BN,4BACSrP,sEADT,KAC4B,WAD5B,IACSA,sEADT,MAC4B,UAD5B,GAC4B4P,EAD5B,GAC4BP,4BACxB9O,4DADwB,KACT,WADS,IACxBA,4DADwB,MACT,UADS,GACTsP,EADS,GACTR,4BACzB1O,oEADyB,KACrB,WADqB,IACzBA,oEADyB,MACrB,UADqB,GACrBmP,EADqB,GACrBT,4BACHzO,sEADG,KACE,WADF,IACHA,sEADG,MACE,UADF,GACEmP,EADF,GACEV,4BACItP,4DADJ,KACmB,WADnB,IACIA,4DADJ,MACmB,UADnB,GACmBiQ,EADnB,GACmBX,4BACRxO,4EADQ,KACa,WADb,IACRA,4EADQ,MACa,UADb,GACaoP,EADb,GACaZ,4BACnCvP,qDADmC,KAC3B,WAD2B,IACnCA,qDADmC,MAC3B,UAD2B,GAC3BoQ,EAD2B,GAC3Bb,4BACNvO,kEADM,KACU,WADV,IACNA,kEADM,MACU,UADV,GACUqP,EADV,GACUd,QAjDV,GAAhBpO,gBAAgB,CAAhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtC8B;AAGN;AAC0B;AAEG;AAI3D,IAAM,cAAc,GAApB,MAAM,cAAc;IACzB,YAAoB,IAAgB,EAC1B,qBAA4C;QADlC,SAAI,GAAJ,IAAI,CAAY;QAC1B,0BAAqB,GAArB,qBAAqB,CAAuB;IAElD,CAAC;IAGL,uBAAuB,CAAC,EAAE,EAAE,IAAI;QAC9B,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAM,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,GAAG,mCAAmC,EAAE,wCAAwC,IAAI,EAAE,CAAC;aACrJ,IAAI,CAAC,mDAAG,CAAC,CAAC,IAAI,EAAE,EAAE;YACjB,OAAO,IAAI,CAAC,OAAO,EAAE,CAAC;QACxB,CAAC,CAAC,CAAC,CAAC;IACR,CAAC;IAED,WAAW,CAAC,cAAc,EAAE,IAAI;QAC9B,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAQ,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,GAAG,UAAU,EAAE;YACjF,IAAI;YACJ,YAAY,EAAE,cAAc;YAC5B,IAAI,EAAE,MAAM;SACb,CAAC,CAAC;IACL,CAAC;;;;;;AApBU,cAAc;IAH1B,yDAAU,CAAC;QACV,UAAU,EAAE,MAAM;KACnB,CAAC;yDAE0B,4DAAU,oBAAV,4DAAU,oDACH,2EAAqB,oBAArB,2EAAqB;GAF3C,cAAc;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACV3B;AACA,MAAMF,OAAO,GAAGqP,+DAAc,CAAC,SAAD,EAAY;EACtCC,GAAG,EAAE,MAAM,+JAAgBjH,IAAhB,CAAqB7E,CAAC,IAAI,IAAIA,CAAC,CAAC+L,UAAN,EAA1B;AAD2B,CAAZ,CAA9B;AAGA","sources":["./src/app/consultation/consultation.module.ts","./src/app/consultation/consultation.page.ts","./src/app/message.service.ts","./node_modules/@capacitor/browser/dist/esm/index.js"],"sourcesContent":["import { VideoRoomPageModule } from './../video-room/video-room.module';\nimport { VideoRoomPage } from './../video-room/video-room.page';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n// translate\nimport { I18nModule } from '../i18n/i18n.module';\n\nimport { ConsultationPage } from './consultation.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ConsultationPage\n  }\n];\n\n@NgModule({\n    imports: [\n        CommonModule,\n        FormsModule,\n        IonicModule,\n        RouterModule.forChild(routes),\n        I18nModule,\n        VideoRoomPageModule\n    ],\n    declarations: [ConsultationPage]\n})\nexport class ConsultationPageModule { }\n","// import { NativeAudio } from \"@awesome-cordova-plugins/native-audio/ngx\";\nimport { NativeAudio } from '@capacitor-community/native-audio'\nimport { Component, AfterViewChecked, ViewChild, OnInit, NgZone, OnDestroy, AfterViewInit, HostListener, Directive  } from \"@angular/core\";\nimport { IonContent, Platform } from \"@ionic/angular\";\nimport { AlertController } from \"@ionic/angular\";\n\nimport { ConsultationService } from \"../consultation.service\";\nimport { Router, ActivatedRoute } from \"@angular/router\";\nimport { MessageService } from \"../message.service\";\nimport { AuthService } from \"../auth/auth.service\";\nimport { SocketEventsService } from \"../socket-events.service\";\nimport { CallService } from \"../call.service\";\n\nimport { ModalController } from \"@ionic/angular\";\nimport { CloseConsultationComponent } from \"../shared/components/close-consultation/close-consultation.component\";\nimport { ChooseAttachmentComponent } from \"../shared/components/choose-attachment/choose-attachment.component\";\nimport { Subscription, Subject } from \"rxjs\";\nimport { first } from \"rxjs/operators\";\n\nimport { File, FileEntry } from \"@awesome-cordova-plugins/file/ngx\";\n\nimport { environment } from \"../../environments/environment\";\n\nimport { Media, MediaObject } from \"@awesome-cordova-plugins/media/ngx\";\nimport { GlobalVariableService } from \"../global-variable.service\";\n\nimport { TranslateService } from \"@ngx-translate/core\";\n\nimport { Browser } from '@capacitor/browser';\n\nimport { IonModal } from '@ionic/angular';\nimport { OverlayEventDetail } from '@ionic/core/components';\n\n@Component({\n  selector: \"app-consultation\",\n  templateUrl: \"./consultation.page.html\",\n  styleUrls: [\"./consultation.page.scss\"],\n})\nexport class ConsultationPage\n  implements OnInit, AfterViewChecked, AfterViewInit\n{\n  @ViewChild(IonContent) contentArea: IonContent;\n  @ViewChild(\"txtArea\") textArea;\n  @ViewChild(IonModal) modal: IonModal;\n\n  currentUser;\n  consultationId;\n  consultation;\n  chatMessages = [];\n  chatText: string;\n  videCall = false;\n  audioFile: MediaObject;\n  loadingMsgs = true;\n  isRecording = false;\n  isFullScreen: boolean;\n  contentScrollTop;\n  isUploading = false;\n  shouldJoinCall = false;\n  ongoingCall = null;\n  callRunning = false;\n\n  // New for display image in modal\n  isImgModalOpen = false;\n  imgModalSrc = null\n  imgModalAlt = null\n  imgModalName = null\n\n\n  private subscriptions: Array<Subscription> = [];\n  private consultationSubscription: Subscription;\n\n  constructor(\n    private callService: CallService,\n    private conServ: ConsultationService,\n    private activeRoute: ActivatedRoute,\n    private router: Router,\n    private msgServ: MessageService,\n    private authService: AuthService,\n    private _socketEventsService: SocketEventsService,\n    private zone: NgZone,\n    private consultationService: ConsultationService,\n    public modalController: ModalController,\n    private file: File,\n    private media: Media,\n    public alertController: AlertController,\n    private globalVariableService: GlobalVariableService,\n    public platform: Platform,\n    private translate: TranslateService,\n    // private nativeAudio: NativeAudio,\n  ) {}\n\n  ngOnInit() {\n    this.currentUser = this.authService.currentUserValue;\n\n    this.consultationId = this.activeRoute.snapshot.params.id;\n    this.getConsultation();\n    this.listenToCallEvents();\n    this.listenToNewMessages();\n  }\n  \n\n  // ionViewDidEnter() {\n  //   document.addEventListener(\"backbutton\", function (e) {\n  //     console.log(\"disable back button\")\n  //     e.preventDefault();\n  //     e.stopPropagation();\n  //     e.stopImmediatePropagation()\n  //   }, false);\n  // }\n\n  @HostListener(\"document:ionBackButton\", [\"$event\"])\n  overrideHardwareBackAction(event: any) {\n    console.log(\"back button\");\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    event.preventDefault();\n    event.detail.register(100, async () => {\n      event.stopImmediatePropagation();\n      event.stopPropagation();\n      event.preventDefault();\n    });\n  }\n\n  listenToNewMessages() {\n    this.subscriptions.push(\n      this._socketEventsService.onMessage().subscribe((msg) => {\n        console.log(\"got message \", msg);\n        if (msg.data.consultation !== this.consultationId) {\n          return;\n        }\n        if (this.chatMessages.find((m) => m.id === msg.data.id)) {\n          return;\n        }\n        this.zone.run(() => {\n          this.chatMessages.push(this.adjustMsg(msg.data));\n        });\n\n        this.scrollToBottom();\n\n        this.readMessages();\n      })\n    );\n  }\n  listenToCallEvents() {\n    this.subscriptions.push(\n      this._socketEventsService.onRejectCall().subscribe((event) => {\n        const message = this.chatMessages.find(\n          (msg) => msg.id === event.data.message.id\n        );\n        console.log(\"video message \", message);\n        if (message) {\n          message.closedAt = new Date();\n        }\n      })\n    );\n    this.subscriptions.push(\n      this._socketEventsService.onAcceptCall().subscribe((event) => {\n        const message = this.chatMessages.find(\n          (msg) => msg.id === event.data.message.id\n        );\n        if (message) {\n          message.acceptedAt = new Date();\n        }\n      })\n    );\n    this.subscriptions.push(\n      this._socketEventsService.onCall().subscribe((e) => {\n        console.log(\"Calll \", e, this.consultation);\n\n        this.hideKeyboard();\n        this.ringing();\n\n        this.zone.run(() => {\n          console.log(\"get call 1\", e);\n          this.callRunning = true;\n          this.ongoingCall = e.data.msg;\n          this.shouldJoinCall = false;\n        });        \n      })\n    );\n    this.subscriptions.push(\n      this._socketEventsService.onEndCall().subscribe((e) => {\n        console.log(\"End Calll \", e);\n\n        this.zone.run(() => {\n          console.log(\"get call 2\", e);\n          this.callRunning = false;\n          this.ongoingCall = null;\n          this.shouldJoinCall = false;\n        });\n      })\n    );\n  }\n  requestCall() {\n    this.callService.requestCall(this.consultation);\n  }\n\n  send(e) {\n    this.textArea.setFocus();\n\n    if (!this.chatText) {\n      return;\n    }\n\n    this.chatText = this.chatText.trim();\n    this.chatMessages.push({\n      direction: \"outgoing\",\n      text: this.chatText,\n      createdAt: Date.now(),\n    });\n    this.scrollToBottom();\n\n    this.subscriptions.push(\n      this.msgServ\n        .sendMessage(\n          this.consultation.id || this.consultation._id,\n          this.chatText\n        )\n        .subscribe(\n          (r) => {\n            console.log(\"mesag send \", r);\n          },\n          (err) => {\n            if (err.error && err.error.message == \"closed\") {\n              this.closeConsultation(this.consultation);\n            }\n          }\n        )\n    );\n    this.chatText = \"\";\n  }\n  ngAfterViewChecked() {\n    //  this.contentArea.scrollToBottom();\n    // this.scrollToBottom();\n    // this.contentArea.scrollToBottom();\n  }\n\n  ngAfterViewInit() {\n    if (this.currentUser && this.currentUser.role !== \"translator\") {\n      this.readMessages();\n    }\n\n    this.subscriptions.push(\n      this.callService.isFullScreen.subscribe((isFullScreen) => {\n        this.isFullScreen = isFullScreen;\n        if (!this.isFullScreen) {\n          this.readMessages();\n        }\n      })\n    );\n  }\n\n  getConsultation() {\n    const lang = window.localStorage.getItem(\"hhp-lang\");\n    this.translate.use(lang);\n    this.consultationSubscription = this.conServ\n      .getConsultation(this.consultationId)\n      .subscribe(async (consultation) => {\n        console.log(\"CURRENT CONSULTATION >>>>>>>>>>>>>>>>\", consultation);\n        if (!consultation || !consultation.consultation) {\n          if (this.consultationSubscription) {\n            this.consultationSubscription.unsubscribe();\n            this.consultationSubscription = null;\n          }\n          localStorage.removeItem(\"currentConsultation\");\n          this._socketEventsService.disconnect();\n          return this.authService.logout();\n          // return this.router.navigate(['login']);\n        }\n        if (\n          !consultation.consultation ||\n          consultation.consultation.status === \"closed\"\n        ) {\n          this.closeConsultation(consultation);\n        }\n\n        this.subscriptions.push(\n          this.callService.getCurrentCall(this.consultationId).subscribe(\n            (call) => {\n              this.ongoingCall = call;\n              this.shouldJoinCall = false;\n            },\n            (err) => {\n              console.log(\"error getting current call \", err);\n            }\n          )\n        );\n\n        this.subscriptions.push(\n          this._socketEventsService.onConsultationClosed().subscribe((e) => {\n            if (e.data._id === this.consultationId) {\n              this.closeConsultation(consultation);\n            }\n          })\n        );\n        this.zone.run(() => {\n          if (!this.consultation) {\n            this.consultation = consultation;\n\n            this.getMessages();\n          } else {\n            this.consultation = consultation;\n          }\n          this.scrollToBottom();\n        });\n      });\n  }\n\n  closeConsultation(consultation) {\n    console.log(\"no consultation.consultation or closed .......\");\n    if (this.consultationSubscription) {\n      this.consultationSubscription.unsubscribe();\n      this.consultationSubscription = null;\n    }\n    localStorage.removeItem(\"currentConsultation\");\n    localStorage.removeItem(\"inviteToken\");\n    this._socketEventsService.disconnect();\n    if (\n      this.currentUser.role === \"guest\" ||\n      this.currentUser.role === \"translator\"\n    ) {\n      this.authService.logout();\n    }\n    return this.router.navigate([\n      \"closing-screen\",\n      consultation.consultation._id || consultation.consultation.id,\n    ]);\n  }\n  readMessages() {\n    if (!this.consultation) {\n      return;\n    }\n\n    const lastMsg = this.chatMessages[this.chatMessages.length - 1];\n    if (\n      this.isFullScreen &&\n      lastMsg &&\n      (lastMsg.type !== \"videoCall\" || lastMsg.type !== \"audioCall\")\n    ) {\n      return;\n    }\n    this.consultationService.readMessages(this.consultationId);\n  }\n\n  sendMsg(event) {\n    if (event.charCode === 13) {\n      this.send(event);\n      return false;\n    }\n  }\n\n  scrollToBottom(after?) {\n    setTimeout(() => {\n      if (this.contentArea) {\n        console.log(\"content area scroll to bottom\", this.contentArea);\n        this.contentArea.scrollToBottom();\n      }\n    }, after || 1);\n  }\n\n  async showCancelModal() {\n    const modal = await this.modalController.create({\n      component: CloseConsultationComponent,\n      componentProps: { consultationId: this.consultationId },\n    });\n    return await modal.present();\n  }\n\n  async showAttachmentModal() {\n    const modal = await this.modalController.create({\n      component: ChooseAttachmentComponent,\n      componentProps: { consultationId: this.consultationId },\n    });\n    await modal.present();\n    const { data } = await modal.onDidDismiss();\n\n    console.log(\"modal dismissed \", data);\n  \n    \n    if (data.filePath) {\n      if (typeof data.filePath === \"object\") {        \n        this.uploadBlob(data.filePath, data.filePath.name);\n        \n        // this.uploadBlob(data.filePath, data.filePath.name);\n      } else if (data.filePath.length > 100000) {\n        const blob = this.b64toBlob(data.filePath, \"image/jpeg\");\n        this.uploadBlob(blob, \"image.jpg\");\n      } \n      else {        \n        this.upload(data.filePath);\n      }\n    }\n  }\n\n  upload(filePath) {\n    \n    this.isUploading = true;\n    this.file\n      .resolveLocalFilesystemUrl(filePath)\n      .then((entry) => {\n        if (entry) {\n          const fileEntry = entry as FileEntry;\n          console.log(\"file entry \", fileEntry);\n          fileEntry.file(\n            (success) => {\n              const mimeType = success.type;\n              console.log(\"type \", mimeType);\n\n              const reader = new FileReader();\n              const self = this;\n              reader.onloadend = function () {\n                const blob = new Blob(\n                  [new Uint8Array(<ArrayBuffer>this.result)],\n                  { type: mimeType }\n                );\n                self.uploadBlob(blob, fileEntry.name);\n              };\n\n              reader.readAsArrayBuffer(success);\n            },\n            (error) => {\n              // no mime type found;\n              alert(\"Error with file type\");\n            }\n          );\n        }\n      })\n      .catch((err) => {\n        console.log(\"error uploading \", err);\n      });\n  }\n\n  uploadBlob(blob, name) {\n    this.isUploading = true;    \n    this.consultationService\n      .postFile(blob, name, this.consultation.id || this.consultation.id)\n      .subscribe((data) => {\n        const msg = data.message;\n        \n        this.zone.run(() => {\n          this.chatMessages.push(this.adjustMsg(msg));\n          this.scrollToBottom();\n          this.isUploading = false;\n        });\n      });\n  }\n\n  // ngOnDestroy(): void {\n  //   console.log('destroy >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>.');\n  //   if (this.consultationSubscription) {\n  //     this.consultationSubscription.unsubscribe();\n  //   }\n  //   this.subscriptions.forEach((subscription: Subscription) => {\n  //     subscription.unsubscribe();\n  //   });\n\n  // }\n \n  startRecording() {\n    this.isRecording = true;\n    const filePath = this.file.externalDataDirectory + Date.now() + \".mp3\";\n    this.audioFile = this.media.create(filePath);\n\n    this.subscriptions.push(\n      this.audioFile.onSuccess.subscribe((amp) => {\n        this.upload(filePath);\n        \n      })\n    );\n    this.subscriptions.push(\n      this.audioFile.onError.subscribe((e) => {\n        console.log(\"Error \", e);\n      })\n    );\n    this.subscriptions.push(\n      this.audioFile.onStatusUpdate.subscribe((status) => console.log(status))\n    );\n\n    this.audioFile.startRecord();\n  }\n  adjustMsg(msg) {\n    if (msg.type === \"attachment\") {\n      msg.attachmentsURL =\n        this.globalVariableService.getApiPath() +\n        `/consultation/${\n          this.consultation._id || this.consultation.id\n        }/attachment/${msg.id}?token=${this.currentUser.token}`;\n\n      if (msg.mimeType.endsWith(\"jpeg\") || msg.mimeType.endsWith(\"png\")) {\n        msg.isImage = true;\n      } else if (msg.mimeType.startsWith(\"audio\")) {\n        msg.isAudio = true;\n      } else {\n        msg.isFile = true;\n      }\n    }\n\n    if (msg.from === this.currentUser.id) {\n      msg.direction = \"outgoing\";\n    } else {\n      msg.direction = \"incoming\";\n    }\n    return msg;\n  }\n\n  getMessages(noScroll?) {\n    if (this.currentUser.role === \"translator\") {\n      return;\n    }\n    this.loadingMsgs = true;\n\n    if (!this.consultation) {\n      return;\n    }\n\n    this.msgServ\n      .getConsultationMessages(\n        this.consultation._id || this.consultation.id,\n        this.chatMessages.length\n      )\n      .pipe(first())\n      .subscribe((msgs) => {\n        this.zone.run(() => {\n          this.chatMessages = msgs\n            .map((m) => {\n              return this.adjustMsg(m);\n            })\n            .concat(this.chatMessages);\n\n          this.loadingMsgs = false;\n\n          if (!noScroll) {\n            this.scrollToBottom(100);\n          }\n        });\n      });\n  }\n\n  public handleScroll(event) {\n    this.contentScrollTop = event.detail.scrollTop;\n    if (event.detail.scrollTop < 400 && !this.loadingMsgs) {\n      this.getMessages(true);\n    }\n  }\n  async stopRecording() {\n    this.isRecording = false;\n    await this.audioFile.stopRecord();\n  }\n\n  public blobToFile = (theBlob: Blob, fileName: string) => {\n    const b: any = theBlob;\n    // A Blob() is almost a File() - it's just missing the two properties below which we will add\n    b.__proto__ = File.prototype;\n    b.lastModifiedDate = new Date();\n    b.name = fileName;\n\n    // Cast to a File() type\n    return <any>theBlob;\n  };\n\n  adjustScroll(event) {\n    console.log(this.contentArea, this.contentScrollTop);\n    console.log(\"scroll to bottom\");\n    this.scrollToBottom(300);\n  }\n\n  hangup() {\n    this.zone.run(() => {\n      console.log(\"leave call\", this.platform.is(\"cordova\"));\n      NativeAudio.stop({assetId: 'ringSound'});\n      this.callRunning = false;\n      this.shouldJoinCall = false;\n    });\n  }\n  joinCall() {\n    this.subscriptions.push(\n      this.callService.getCurrentCall(this.consultationId).subscribe(\n        (call) => {\n          console.log(\"JOIN CALL \", call);\n          this.shouldJoinCall = true;\n          this.ongoingCall = call;\n        },\n        (err) => {\n          console.log(\"error getting current call \", err);\n        }\n      )\n    );\n  }\n  ringing() {\n    console.log(\"CURRENT PLATFORM\", this.platform);\n    this.platform\n      .ready()\n      .then(() => {\n        console.log(\"RINGING NOW\", NativeAudio.loop);\n        NativeAudio.play({assetId:'ringSound', time: 0});\n        return NativeAudio.loop({assetId:\"ringSound\"});\n        // if (this.platform.is(\"capacitor\")) {\n        //   console.log(\"RINGING NOW\", this.nativeAudio.loop);\n        //   return this.nativeAudio.loop(\"ringSound\");\n        // }\n      })\n      .then(\n        (res) => {},\n        (err) => {\n          console.log(\"error \", err);\n        }\n      );\n  }\n\n  openlink(url) {\n    console.log(\"opening\", url)\n    Browser.open({ url: url});\n  }\n\n  openImgModal(img) {\n    \n    this.imgModalSrc = img.target.currentSrc\n    this.imgModalAlt = img.target.alt\n    this.imgModalName = \"Image\"\n    this.isImgModalOpen = true;\n  }\n  closeImgModal(isOpen: boolean) {\n    this.isImgModalOpen = isOpen\n  }\n\n\n  hideKeyboard() {\n    // this set timeout needed for case when hideKeyborad\n    // is called inside of 'onfocus' event handler\n    setTimeout(function () {\n      // creating temp field\n      const field = document.createElement(\"input\");\n      field.setAttribute(\"type\", \"text\");\n      // hiding temp field from peoples eyes\n      // -webkit-user-modify is nessesary for Android 4.x\n      field.setAttribute(\n        \"style\",\n        \"position:absolute; top: 0px; opacity: 0; -webkit-user-modify: read-write-plaintext-only; left:0px;\"\n      );\n      document.body.appendChild(field);\n\n      // adding onfocus event handler for out temp field\n      field.onfocus = function () {\n        // this timeout of 200ms is nessasary for Android 2.3.x\n        setTimeout(function () {\n          field.setAttribute(\"style\", \"display:none;\");\n          setTimeout(function () {\n            document.body.removeChild(field);\n            document.body.focus();\n          }, 14);\n        }, 200);\n      };\n      // focusing it\n      field.focus();\n    }, 50);\n  }\n\n  /**\n   * Convert a base64 string in a Blob according to the data and contentType.\n   *\n   * @param b64Data {String} Pure base64 string without contentType\n   * @param contentType {String} the content type of the file i.e (image/jpeg - image/png - text/plain)\n   * @param sliceSize {Int} SliceSize to process the byteCharacters\n   * @see http://stackoverflow.com/questions/16245767/creating-a-blob-from-a-base64-string-in-javascript\n   * @return Blob\n   */\n  b64toBlob(b64Data, contentType, sliceSize?) {\n    contentType = contentType || \"\";\n    sliceSize = sliceSize || 512;\n\n    var byteCharacters = atob(b64Data);\n    var byteArrays = [];\n\n    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\n\n      var byteNumbers = new Array(slice.length);\n      for (var i = 0; i < slice.length; i++) {\n        byteNumbers[i] = slice.charCodeAt(i);\n      }\n\n      var byteArray = new Uint8Array(byteNumbers);\n\n      byteArrays.push(byteArray);\n    }\n\n    var blob = new Blob(byteArrays, { type: contentType });\n    \n    return blob;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { environment } from '../environments/environment';\nimport { GlobalVariableService } from './global-variable.service';\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  constructor(private http: HttpClient,\n    private globalVariableService: GlobalVariableService\n\n  ) { }\n\n\n  getConsultationMessages(id, skip): Observable<any> {\n    return this.http.get<any>(this.globalVariableService.getApiPath() + `/message?where={\"consultation\":\"${id}\"}&sort=createdAt DESC&limit=20&skip=${skip}`)\n      .pipe(map((msgs) => {\n        return msgs.reverse();\n      }));\n  }\n\n  sendMessage(consultationId, text): Observable<any> {\n    return this.http.post<any[]>(this.globalVariableService.getApiPath() + `/message`, {\n      text,\n      consultation: consultationId,\n      type: 'text'\n    });\n  }\n\n\n}\n","import { registerPlugin } from '@capacitor/core';\nconst Browser = registerPlugin('Browser', {\n    web: () => import('./web').then(m => new m.BrowserWeb()),\n});\nexport * from './definitions';\nexport { Browser };\n"],"names":["NativeAudio","Component","ViewChild","NgZone","HostListener","IonContent","Platform","AlertController","ConsultationService","Router","ActivatedRoute","MessageService","AuthService","SocketEventsService","CallService","ModalController","CloseConsultationComponent","ChooseAttachmentComponent","first","File","Media","GlobalVariableService","TranslateService","Browser","IonModal","ConsultationPage","constructor","callService","conServ","activeRoute","router","msgServ","authService","_socketEventsService","zone","consultationService","modalController","file","media","alertController","globalVariableService","platform","translate","theBlob","fileName","b","__proto__","prototype","lastModifiedDate","Date","name","ngOnInit","currentUser","currentUserValue","consultationId","snapshot","params","id","getConsultation","listenToCallEvents","listenToNewMessages","overrideHardwareBackAction","event","console","log","stopImmediatePropagation","stopPropagation","preventDefault","detail","register","subscriptions","push","onMessage","subscribe","msg","data","consultation","chatMessages","find","m","run","adjustMsg","scrollToBottom","readMessages","onRejectCall","message","closedAt","onAcceptCall","acceptedAt","onCall","e","hideKeyboard","ringing","callRunning","ongoingCall","shouldJoinCall","onEndCall","requestCall","send","textArea","setFocus","chatText","trim","direction","text","createdAt","now","sendMessage","_id","r","err","error","closeConsultation","ngAfterViewChecked","ngAfterViewInit","role","isFullScreen","lang","window","localStorage","getItem","use","consultationSubscription","unsubscribe","removeItem","disconnect","logout","status","getCurrentCall","call","onConsultationClosed","getMessages","navigate","lastMsg","length","type","sendMsg","charCode","after","setTimeout","contentArea","showCancelModal","modal","create","component","componentProps","present","showAttachmentModal","onDidDismiss","filePath","uploadBlob","blob","b64toBlob","upload","isUploading","resolveLocalFilesystemUrl","then","entry","fileEntry","success","mimeType","reader","FileReader","self","onloadend","Blob","Uint8Array","result","readAsArrayBuffer","alert","catch","postFile","startRecording","isRecording","externalDataDirectory","audioFile","onSuccess","amp","onError","onStatusUpdate","startRecord","attachmentsURL","getApiPath","token","endsWith","isImage","startsWith","isAudio","isFile","from","noScroll","loadingMsgs","getConsultationMessages","pipe","msgs","map","concat","handleScroll","contentScrollTop","scrollTop","stopRecording","stopRecord","adjustScroll","hangup","is","stop","assetId","joinCall","ready","loop","play","time","res","openlink","url","open","openImgModal","img","imgModalSrc","target","currentSrc","imgModalAlt","alt","imgModalName","isImgModalOpen","closeImgModal","isOpen","field","document","createElement","setAttribute","body","appendChild","onfocus","removeChild","focus","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","slice","byteNumbers","Array","i","charCodeAt","byteArray","args","selector","template","_b","Object","_c","_d","_e","_f","_g","_h","_j","_k","_l","_m","_o","_p","_q","_r","registerPlugin","web","BrowserWeb"],"sourceRoot":"webpack:///","x_google_ignoreList":[3]}